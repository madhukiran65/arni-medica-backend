# Generated by Django 5.2.11 on 2026-02-25 01:19

import django.db.models.deletion
import django.utils.timezone
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('capa', '0001_initial'),
        ('users', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Complaint',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('complaint_id', models.CharField(help_text='Auto-generated identifier: CMP-YYYY-NNNN', max_length=50, unique=True)),
                ('title', models.CharField(max_length=255)),
                ('description', models.TextField(help_text='Detailed complaint description')),
                ('status', models.CharField(choices=[('new', 'New'), ('under_investigation', 'Under Investigation'), ('capa_initiated', 'CAPA Initiated'), ('investigation_complete', 'Investigation Complete'), ('closed', 'Closed'), ('rejected', 'Rejected')], db_index=True, default='new', max_length=30)),
                ('stage_entered_at', models.DateTimeField(default=django.utils.timezone.now, help_text='Timestamp when complaint entered current status')),
                ('complainant_name', models.CharField(max_length=255)),
                ('complainant_email', models.EmailField(max_length=254)),
                ('complainant_phone', models.CharField(blank=True, max_length=20)),
                ('complainant_organization', models.CharField(blank=True, max_length=255)),
                ('complainant_type', models.CharField(choices=[('customer', 'Customer'), ('patient', 'Patient'), ('healthcare_provider', 'Healthcare Provider'), ('distributor', 'Distributor'), ('internal', 'Internal'), ('regulatory_authority', 'Regulatory Authority'), ('other', 'Other')], max_length=30)),
                ('product_name', models.CharField(max_length=255)),
                ('product_code', models.CharField(max_length=100)),
                ('product_lot_number', models.CharField(blank=True, max_length=100)),
                ('product_serial_number', models.CharField(blank=True, max_length=100)),
                ('manufacture_date', models.DateField(blank=True, null=True)),
                ('expiry_date', models.DateField(blank=True, null=True)),
                ('product_description', models.TextField(blank=True)),
                ('event_date', models.DateField(blank=True, help_text='Date when the complaint event occurred', null=True)),
                ('event_description', models.TextField()),
                ('event_location', models.CharField(max_length=255)),
                ('event_country', models.CharField(max_length=100)),
                ('sample_available', models.BooleanField(default=False)),
                ('sample_received_date', models.DateField(blank=True, null=True)),
                ('category', models.CharField(choices=[('product_quality', 'Product Quality'), ('product_performance', 'Product Performance'), ('labeling', 'Labeling'), ('packaging', 'Packaging'), ('documentation', 'Documentation'), ('service', 'Service'), ('other', 'Other')], max_length=30)),
                ('severity', models.CharField(choices=[('critical', 'Critical'), ('major', 'Major'), ('minor', 'Minor')], db_index=True, max_length=20)),
                ('priority', models.CharField(choices=[('high', 'High'), ('medium', 'Medium'), ('low', 'Low')], max_length=20)),
                ('event_type', models.CharField(choices=[('death', 'Death'), ('serious_injury', 'Serious Injury'), ('malfunction', 'Malfunction'), ('other', 'Other'), ('none', 'None')], db_index=True, default='none', help_text='FDA 3500A event type classification', max_length=30)),
                ('patient_age', models.IntegerField(blank=True, help_text='Patient age in years', null=True)),
                ('patient_sex', models.CharField(blank=True, choices=[('male', 'Male'), ('female', 'Female'), ('unknown', 'Unknown')], max_length=20, null=True)),
                ('patient_weight_kg', models.DecimalField(blank=True, decimal_places=2, help_text='Patient weight in kilograms', max_digits=6, null=True)),
                ('health_effect', models.TextField(blank=True, help_text='Description of health effect reported')),
                ('device_usage', models.CharField(blank=True, choices=[('initial_use', 'Initial Use'), ('reuse', 'Reuse'), ('unknown', 'Unknown')], max_length=20, null=True)),
                ('device_available', models.CharField(blank=True, choices=[('yes', 'Yes'), ('no', 'No'), ('returned_to_manufacturer', 'Returned to Manufacturer'), ('unknown', 'Unknown')], max_length=30, null=True)),
                ('is_reportable_to_fda', models.BooleanField(db_index=True, default=False, help_text='Whether this complaint meets FDA reportability criteria')),
                ('reportability_determination_date', models.DateField(blank=True, help_text='Date reportability decision was made', null=True)),
                ('reportability_justification', models.TextField(blank=True, help_text='Explanation of reportability determination')),
                ('awareness_date', models.DateField(blank=True, help_text='Date manufacturer became aware of the event', null=True)),
                ('mdr_report_number', models.CharField(blank=True, help_text='FDA assigned MDR report number', max_length=100, null=True)),
                ('mdr_submission_date', models.DateField(blank=True, help_text='Date MDR was submitted to FDA', null=True)),
                ('mdr_submission_status', models.CharField(choices=[('not_required', 'Not Required'), ('pending', 'Pending'), ('submitted', 'Submitted'), ('acknowledged', 'Acknowledged'), ('follow_up_required', 'Follow-up Required')], default='not_required', help_text='Current MDR submission status', max_length=30)),
                ('mdr_report_type', models.CharField(blank=True, choices=[('initial', 'Initial'), ('follow_up', 'Follow-up'), ('supplemental', 'Supplemental')], help_text='Type of MDR report (initial, follow-up, supplemental)', max_length=20, null=True)),
                ('fda_reference_number', models.CharField(blank=True, help_text='FDA reference or tracking number', max_length=100, null=True)),
                ('investigation_summary', models.TextField(blank=True, help_text='Summary of investigation findings')),
                ('root_cause', models.TextField(blank=True, help_text='Root cause analysis')),
                ('investigation_completed_date', models.DateField(blank=True, null=True)),
                ('resolution_description', models.TextField(blank=True, help_text='Description of how complaint was resolved')),
                ('corrective_action', models.TextField(blank=True, help_text='Corrective action(s) taken')),
                ('preventive_action', models.TextField(blank=True, help_text='Preventive action(s) to avoid recurrence')),
                ('received_date', models.DateTimeField(default=django.utils.timezone.now, help_text='When complaint was received')),
                ('target_closure_date', models.DateField(blank=True, help_text='Target date for closure', null=True)),
                ('actual_closure_date', models.DateField(blank=True, help_text='Actual date when complaint was closed', null=True)),
                ('is_trending', models.BooleanField(default=False, help_text='Whether this complaint is part of a trend')),
                ('trend_category', models.CharField(blank=True, help_text='Category if part of a trend', max_length=100)),
                ('requires_field_action', models.BooleanField(default=False, help_text='Whether field action is required')),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_complaints', to=settings.AUTH_USER_MODEL)),
                ('capa', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='complaints', to='capa.capa')),
                ('closed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='closed_complaints', to=settings.AUTH_USER_MODEL)),
                ('coordinator', models.ForeignKey(blank=True, help_text='Complaint coordinator', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='coordinated_complaints', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('department', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='complaints', to='users.department')),
                ('investigated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='complaint_investigations', to=settings.AUTH_USER_MODEL)),
                ('reportability_determined_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reportability_determinations', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Complaint',
                'verbose_name_plural': 'Complaints',
                'ordering': ['-received_date'],
            },
        ),
        migrations.CreateModel(
            name='ComplaintAttachment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('file', models.FileField(upload_to='complaints/%Y/%m/%d/')),
                ('file_name', models.CharField(max_length=255)),
                ('file_type', models.CharField(max_length=50)),
                ('file_size', models.BigIntegerField(help_text='File size in bytes')),
                ('attachment_type', models.CharField(choices=[('investigation_report', 'Investigation Report'), ('fda_3500a', 'FDA 3500A Form'), ('fda_3500h', 'FDA 3500H Form'), ('customer_correspondence', 'Customer Correspondence'), ('photo', 'Photo'), ('lab_result', 'Lab Result'), ('other', 'Other')], max_length=30)),
                ('description', models.TextField(blank=True)),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('complaint', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attachments', to='complaints.complaint')),
                ('uploaded_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='complaint_attachments', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Complaint Attachment',
                'verbose_name_plural': 'Complaint Attachments',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='ComplaintComment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('comment', models.TextField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('author', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='complaint_comments', to=settings.AUTH_USER_MODEL)),
                ('complaint', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='comments', to='complaints.complaint')),
                ('parent', models.ForeignKey(blank=True, help_text='Parent comment if this is a reply', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='replies', to='complaints.complaintcomment')),
            ],
            options={
                'verbose_name': 'Complaint Comment',
                'verbose_name_plural': 'Complaint Comments',
                'ordering': ['created_at'],
            },
        ),
        migrations.CreateModel(
            name='MIRRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('mir_number', models.CharField(help_text='Unique MIR identifier', max_length=100, unique=True)),
                ('report_type', models.CharField(choices=[('initial', 'Initial'), ('follow_up', 'Follow-up'), ('supplemental', 'Supplemental')], max_length=20)),
                ('submitted_date', models.DateField(blank=True, help_text='Date MIR was submitted to FDA', null=True)),
                ('submitted_to', models.CharField(blank=True, help_text='FDA office or address MIR was submitted to', max_length=255)),
                ('narrative', models.TextField(help_text='Narrative description for this MIR')),
                ('patient_outcome', models.TextField(blank=True, help_text='Patient outcome information')),
                ('device_evaluation_summary', models.TextField(blank=True, help_text='Summary of device evaluation findings')),
                ('complaint', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='mir_records', to='complaints.complaint')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('parent_mir', models.ForeignKey(blank=True, help_text='Reference to parent MIR if this is a follow-up', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='follow_up_records', to='complaints.mirrecord')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'MIR Record',
                'verbose_name_plural': 'MIR Records',
                'ordering': ['-submitted_date'],
            },
        ),
        migrations.AddIndex(
            model_name='complaint',
            index=models.Index(fields=['complaint_id'], name='complaints__complai_ea9dba_idx'),
        ),
        migrations.AddIndex(
            model_name='complaint',
            index=models.Index(fields=['status'], name='complaints__status_7c8de0_idx'),
        ),
        migrations.AddIndex(
            model_name='complaint',
            index=models.Index(fields=['severity'], name='complaints__severit_008f1f_idx'),
        ),
        migrations.AddIndex(
            model_name='complaint',
            index=models.Index(fields=['event_type'], name='complaints__event_t_85bc5c_idx'),
        ),
        migrations.AddIndex(
            model_name='complaint',
            index=models.Index(fields=['is_reportable_to_fda'], name='complaints__is_repo_dbfb51_idx'),
        ),
        migrations.AddIndex(
            model_name='complaint',
            index=models.Index(fields=['mdr_submission_status'], name='complaints__mdr_sub_676116_idx'),
        ),
        migrations.AddIndex(
            model_name='complaint',
            index=models.Index(fields=['received_date'], name='complaints__receive_7b911c_idx'),
        ),
    ]
