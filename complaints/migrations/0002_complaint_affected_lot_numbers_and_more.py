# Generated by Django 5.2.11 on 2026-02-26 21:33

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('capa', '0004_capa_auto_generated_capa_effectiveness_eligible_date_and_more'),
        ('complaints', '0001_initial'),
        ('documents', '0005_document_requires_dual_approval_and_more'),
        ('users', '0004_role_field_level_permissions_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.AddField(
            model_name='complaint',
            name='affected_lot_numbers',
            field=models.JSONField(blank=True, default=list, help_text='List of affected lot/batch numbers'),
        ),
        migrations.AddField(
            model_name='complaint',
            name='auto_generated_form',
            field=models.CharField(blank=True, choices=[('fda_3500a', 'FDA 3500A'), ('fda_3500', 'FDA 3500'), ('emdr', 'eMDR'), ('mir', 'MIR'), ('none', 'None')], default='none', help_text='Auto-generated regulatory form type', max_length=50),
        ),
        migrations.AddField(
            model_name='complaint',
            name='patient_follow_up_required',
            field=models.BooleanField(default=False, help_text='Whether patient follow-up is required'),
        ),
        migrations.AddField(
            model_name='complaint',
            name='patient_follow_up_status',
            field=models.CharField(blank=True, choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('na', 'N/A')], default='na', help_text='Status of patient follow-up', max_length=20),
        ),
        migrations.AddField(
            model_name='complaint',
            name='pms_linked',
            field=models.BooleanField(default=False, help_text='Linked to PMS (Post-Market Surveillance) trend analysis'),
        ),
        migrations.AddField(
            model_name='complaint',
            name='quarantine_triggered',
            field=models.BooleanField(default=False, help_text='Whether product quarantine was initiated'),
        ),
        migrations.AddField(
            model_name='complaint',
            name='reportability_decision_tree',
            field=models.JSONField(blank=True, default=dict, help_text='Decision tree answers for reportability determination'),
        ),
        migrations.CreateModel(
            name='PMSPlan',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('plan_id', models.CharField(editable=False, max_length=50, unique=True)),
                ('title', models.CharField(max_length=255)),
                ('product_name', models.CharField(max_length=255)),
                ('plan_version', models.CharField(max_length=50)),
                ('data_sources', models.JSONField(default=list, help_text='List of data sources: complaints, literature, clinical, service')),
                ('monitoring_criteria', models.TextField()),
                ('review_frequency', models.CharField(choices=[('monthly', 'Monthly'), ('quarterly', 'Quarterly'), ('semi_annual', 'Semi-Annual'), ('annual', 'Annual')], max_length=20)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('active', 'Active'), ('under_review', 'Under Review'), ('closed', 'Closed')], default='draft', max_length=20)),
                ('effective_date', models.DateField(blank=True, null=True)),
                ('next_review_date', models.DateField(blank=True, null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('department', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='users.department')),
                ('product_line', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='users.productline')),
                ('responsible_person', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pms_plans', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='LiteratureReview',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('review_id', models.CharField(editable=False, max_length=50, unique=True)),
                ('title', models.CharField(max_length=255)),
                ('search_strategy', models.TextField()),
                ('databases_searched', models.JSONField(default=list)),
                ('search_date', models.DateField()),
                ('articles_found', models.IntegerField(default=0)),
                ('articles_relevant', models.IntegerField(default=0)),
                ('key_findings', models.JSONField(default=list)),
                ('safety_signals_identified', models.BooleanField(default=False)),
                ('signal_description', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('planned', 'Planned'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('action_required', 'Action Required')], default='planned', max_length=20)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('reviewed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='literature_reviews', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('pms_plan', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='literature_reviews', to='complaints.pmsplan')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='PMSReport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('report_id', models.CharField(editable=False, max_length=50, unique=True)),
                ('title', models.CharField(max_length=255)),
                ('report_type', models.CharField(choices=[('pms_report', 'PMS Report'), ('psur', 'PSUR'), ('pmcf_report', 'PMCF Report'), ('pms_update', 'PMS Update'), ('sscp', 'SSCP'), ('trend_report', 'Trend Report')], max_length=20)),
                ('period_start', models.DateField()),
                ('period_end', models.DateField()),
                ('executive_summary', models.TextField()),
                ('conclusions', models.TextField()),
                ('recommendations', models.TextField()),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('in_review', 'In Review'), ('approved', 'Approved'), ('submitted', 'Submitted')], default='draft', max_length=20)),
                ('submitted_to', models.CharField(blank=True, choices=[('fda', 'FDA'), ('ema', 'EMA'), ('cdsco', 'CDSCO'), ('notified_body', 'Notified Body'), ('internal', 'Internal'), ('other', 'Other')], max_length=20, null=True)),
                ('submission_date', models.DateField(blank=True, null=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_pms_reports', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('linked_document', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='documents.document')),
                ('pms_plan', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reports', to='complaints.pmsplan')),
                ('product_line', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='users.productline')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='SafetySignal',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('signal_id', models.CharField(editable=False, max_length=50, unique=True)),
                ('title', models.CharField(max_length=255)),
                ('description', models.TextField()),
                ('source', models.CharField(choices=[('complaints', 'Complaints'), ('literature', 'Literature'), ('clinical_data', 'Clinical Data'), ('registry', 'Registry'), ('proactive_monitoring', 'Proactive Monitoring')], max_length=25)),
                ('detection_date', models.DateField()),
                ('severity', models.CharField(choices=[('critical', 'Critical'), ('major', 'Major'), ('minor', 'Minor')], max_length=10)),
                ('status', models.CharField(choices=[('detected', 'Detected'), ('under_evaluation', 'Under Evaluation'), ('confirmed', 'Confirmed'), ('refuted', 'Refuted'), ('closed', 'Closed')], default='detected', max_length=20)),
                ('evaluation_summary', models.TextField(blank=True)),
                ('risk_assessment', models.TextField(blank=True)),
                ('action_taken', models.TextField(blank=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('evaluated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='safety_signals_evaluated', to=settings.AUTH_USER_MODEL)),
                ('linked_capa', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='safety_signals', to='capa.capa')),
                ('linked_pms_plan', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='safety_signals', to='complaints.pmsplan')),
                ('product_line', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='safety_signals', to='users.productline')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='TrendAnalysis',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('trend_id', models.CharField(editable=False, max_length=50, unique=True)),
                ('analysis_period_start', models.DateField()),
                ('analysis_period_end', models.DateField()),
                ('complaint_count', models.IntegerField(default=0)),
                ('complaint_rate', models.DecimalField(blank=True, decimal_places=4, max_digits=10, null=True)),
                ('previous_period_rate', models.DecimalField(blank=True, decimal_places=4, max_digits=10, null=True)),
                ('trend_direction', models.CharField(choices=[('increasing', 'Increasing'), ('decreasing', 'Decreasing'), ('stable', 'Stable'), ('insufficient_data', 'Insufficient Data')], max_length=20)),
                ('threshold_breached', models.BooleanField(default=False)),
                ('statistical_method', models.CharField(choices=[('control_chart', 'Control Chart'), ('pareto', 'Pareto'), ('regression', 'Regression'), ('chi_square', 'Chi-Square'), ('other', 'Other')], max_length=20)),
                ('analysis_summary', models.TextField()),
                ('key_findings', models.JSONField(default=list)),
                ('recommended_actions', models.JSONField(default=list)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('reviewed', 'Reviewed'), ('approved', 'Approved'), ('action_required', 'Action Required')], default='draft', max_length=20)),
                ('analyzed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='trend_analyses', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('pms_plan', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='trend_analyses', to='complaints.pmsplan')),
                ('product_line', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='users.productline')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='VigilanceReport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('vigilance_id', models.CharField(editable=False, max_length=50, unique=True)),
                ('report_form', models.CharField(choices=[('fda_3500a', 'FDA 3500A'), ('fda_3500', 'FDA 3500'), ('emdr', 'EMDR'), ('mir', 'MIR'), ('field_safety_notice', 'Field Safety Notice'), ('field_safety_corrective_action', 'Field Safety Corrective Action')], max_length=30)),
                ('authority', models.CharField(choices=[('fda', 'FDA'), ('ema', 'EMA'), ('cdsco', 'CDSCO'), ('tga', 'TGA'), ('health_canada', 'Health Canada'), ('mhra', 'MHRA'), ('other', 'Other')], max_length=20)),
                ('report_type', models.CharField(choices=[('initial', 'Initial'), ('followup', 'Follow-up'), ('final', 'Final')], max_length=20)),
                ('submission_deadline', models.DateField()),
                ('actual_submission_date', models.DateField(blank=True, null=True)),
                ('tracking_number', models.CharField(blank=True, max_length=100, null=True)),
                ('narrative', models.TextField()),
                ('patient_outcome', models.CharField(blank=True, choices=[('death', 'Death'), ('life_threatening', 'Life Threatening'), ('hospitalization', 'Hospitalization'), ('disability', 'Disability'), ('congenital_anomaly', 'Congenital Anomaly'), ('intervention_required', 'Intervention Required'), ('other', 'Other'), ('unknown', 'Unknown')], max_length=25, null=True)),
                ('device_udi', models.CharField(blank=True, max_length=100, null=True)),
                ('lot_number', models.CharField(blank=True, max_length=100, null=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('pending_submission', 'Pending Submission'), ('submitted', 'Submitted'), ('acknowledged', 'Acknowledged'), ('closed', 'Closed')], default='draft', max_length=20)),
                ('authority_response', models.TextField(blank=True)),
                ('response_date', models.DateField(blank=True, null=True)),
                ('complaint', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='vigilance_reports', to='complaints.complaint')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('submitted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='vigilance_reports', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddIndex(
            model_name='pmsplan',
            index=models.Index(fields=['plan_id'], name='complaints__plan_id_b1e6bf_idx'),
        ),
        migrations.AddIndex(
            model_name='pmsplan',
            index=models.Index(fields=['status'], name='complaints__status_a874a5_idx'),
        ),
        migrations.AddIndex(
            model_name='pmsplan',
            index=models.Index(fields=['product_line'], name='complaints__product_54b731_idx'),
        ),
        migrations.AddIndex(
            model_name='literaturereview',
            index=models.Index(fields=['review_id'], name='complaints__review__91c242_idx'),
        ),
        migrations.AddIndex(
            model_name='literaturereview',
            index=models.Index(fields=['status'], name='complaints__status_d9d3c8_idx'),
        ),
        migrations.AddIndex(
            model_name='literaturereview',
            index=models.Index(fields=['pms_plan'], name='complaints__pms_pla_43f1e2_idx'),
        ),
        migrations.AddIndex(
            model_name='pmsreport',
            index=models.Index(fields=['report_id'], name='complaints__report__49d215_idx'),
        ),
        migrations.AddIndex(
            model_name='pmsreport',
            index=models.Index(fields=['status'], name='complaints__status_021c9e_idx'),
        ),
        migrations.AddIndex(
            model_name='pmsreport',
            index=models.Index(fields=['report_type'], name='complaints__report__3d30f7_idx'),
        ),
        migrations.AddIndex(
            model_name='safetysignal',
            index=models.Index(fields=['signal_id'], name='complaints__signal__24d07d_idx'),
        ),
        migrations.AddIndex(
            model_name='safetysignal',
            index=models.Index(fields=['status'], name='complaints__status_5656e2_idx'),
        ),
        migrations.AddIndex(
            model_name='safetysignal',
            index=models.Index(fields=['severity'], name='complaints__severit_7963e9_idx'),
        ),
        migrations.AddIndex(
            model_name='trendanalysis',
            index=models.Index(fields=['trend_id'], name='complaints__trend_i_1f449c_idx'),
        ),
        migrations.AddIndex(
            model_name='trendanalysis',
            index=models.Index(fields=['pms_plan'], name='complaints__pms_pla_82e4aa_idx'),
        ),
        migrations.AddIndex(
            model_name='trendanalysis',
            index=models.Index(fields=['status'], name='complaints__status_431825_idx'),
        ),
        migrations.AddIndex(
            model_name='vigilancereport',
            index=models.Index(fields=['vigilance_id'], name='complaints__vigilan_e1033d_idx'),
        ),
        migrations.AddIndex(
            model_name='vigilancereport',
            index=models.Index(fields=['status'], name='complaints__status_bfd181_idx'),
        ),
        migrations.AddIndex(
            model_name='vigilancereport',
            index=models.Index(fields=['authority'], name='complaints__authori_f8adc9_idx'),
        ),
    ]
