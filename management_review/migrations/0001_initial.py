# Generated by Django 5.2.11 on 2026-02-26 21:33

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('capa', '0004_capa_auto_generated_capa_effectiveness_eligible_date_and_more'),
        ('change_controls', '0003_changecontrol_all_child_tasks_complete_and_more'),
        ('documents', '0005_document_requires_dual_approval_and_more'),
        ('users', '0004_role_field_level_permissions_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ManagementReviewMeeting',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('meeting_id', models.CharField(db_index=True, max_length=50, unique=True)),
                ('title', models.CharField(max_length=255)),
                ('meeting_type', models.CharField(choices=[('scheduled', 'Scheduled'), ('special', 'Special'), ('follow_up', 'Follow-up')], default='scheduled', max_length=50)),
                ('review_period_start', models.DateField()),
                ('review_period_end', models.DateField()),
                ('meeting_date', models.DateField(db_index=True)),
                ('meeting_time', models.TimeField(blank=True, null=True)),
                ('location', models.CharField(blank=True, max_length=255, null=True)),
                ('agenda', models.JSONField(blank=True, default=list, help_text='List of agenda items/topics')),
                ('status', models.CharField(choices=[('planned', 'Planned'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], default='planned', max_length=50)),
                ('attendees', models.ManyToManyField(blank=True, related_name='mr_attendees', to=settings.AUTH_USER_MODEL)),
                ('chairperson', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='chaired_reviews', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Management Review Meeting',
                'verbose_name_plural': 'Management Review Meetings',
                'ordering': ['-meeting_date'],
            },
        ),
        migrations.CreateModel(
            name='ManagementReviewItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('item_number', models.IntegerField()),
                ('topic', models.CharField(max_length=255)),
                ('category', models.CharField(choices=[('quality_policy', 'Quality Policy & Objectives'), ('audit_results', 'Audit Results'), ('customer_feedback', 'Customer Feedback'), ('process_performance', 'Process Performance'), ('product_conformity', 'Product Conformity'), ('capa_status', 'CAPA Status'), ('changes', 'Changes'), ('improvement_opportunities', 'Improvement Opportunities'), ('resource_needs', 'Resource Needs'), ('supplier_performance', 'Supplier Performance'), ('risk_assessment', 'Risk Assessment'), ('regulatory_updates', 'Regulatory Updates'), ('training_status', 'Training Status')], max_length=50)),
                ('discussion_summary', models.TextField(blank=True)),
                ('data_snapshot', models.JSONField(blank=True, default=dict, help_text='Snapshot of relevant data/metrics for this topic')),
                ('decisions', models.JSONField(blank=True, default=list, help_text='List of decisions made regarding this item')),
                ('action_items', models.JSONField(blank=True, default=list, help_text='List of action items stemming from discussion')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('presenter', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='presented_review_items', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('meeting', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='management_review.managementreviewmeeting')),
            ],
            options={
                'verbose_name': 'Management Review Item',
                'verbose_name_plural': 'Management Review Items',
                'ordering': ['meeting', 'item_number'],
            },
        ),
        migrations.CreateModel(
            name='ManagementReviewAction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('action_id', models.CharField(db_index=True, max_length=50, unique=True)),
                ('description', models.TextField()),
                ('due_date', models.DateField(db_index=True)),
                ('priority', models.CharField(choices=[('critical', 'Critical'), ('high', 'High'), ('medium', 'Medium'), ('low', 'Low')], default='medium', max_length=50)),
                ('status', models.CharField(choices=[('open', 'Open'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('overdue', 'Overdue'), ('cancelled', 'Cancelled')], default='open', max_length=50)),
                ('completion_date', models.DateField(blank=True, null=True)),
                ('completion_notes', models.TextField(blank=True)),
                ('assigned_to', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_mr_actions', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('linked_capa', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='mr_actions', to='capa.capa')),
                ('linked_change_control', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='mr_actions', to='change_controls.changecontrol')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('review_item', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='actions', to='management_review.managementreviewitem')),
                ('meeting', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='actions', to='management_review.managementreviewmeeting')),
            ],
            options={
                'verbose_name': 'Management Review Action',
                'verbose_name_plural': 'Management Review Actions',
                'ordering': ['-due_date'],
            },
        ),
        migrations.CreateModel(
            name='ManagementReviewReport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('report_id', models.CharField(db_index=True, max_length=50, unique=True)),
                ('title', models.CharField(max_length=255)),
                ('executive_summary', models.TextField()),
                ('key_decisions', models.JSONField(blank=True, default=list, help_text='List of key decisions from the meeting')),
                ('open_actions_count', models.IntegerField(default=0)),
                ('overall_quality_assessment', models.CharField(choices=[('excellent', 'Excellent'), ('satisfactory', 'Satisfactory'), ('needs_improvement', 'Needs Improvement'), ('unsatisfactory', 'Unsatisfactory')], default='satisfactory', max_length=50)),
                ('next_review_date', models.DateField(blank=True, null=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('in_review', 'In Review'), ('approved', 'Approved')], default='draft', max_length=50)),
                ('approval_date', models.DateTimeField(blank=True, null=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_mr_reports', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('linked_document', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='mr_reports', to='documents.document')),
                ('meeting', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='report', to='management_review.managementreviewmeeting')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Management Review Report',
                'verbose_name_plural': 'Management Review Reports',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='QualityMetric',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('metric_id', models.CharField(db_index=True, max_length=50, unique=True)),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('module', models.CharField(choices=[('documents', 'Document Control'), ('capa', 'CAPA Management'), ('complaints', 'Complaint Handling'), ('training', 'Training Management'), ('deviations', 'Deviation Management'), ('change_controls', 'Change Control'), ('suppliers', 'Supplier Management'), ('audits', 'Audit Management'), ('risk_management', 'Risk Management'), ('equipment', 'Equipment Management'), ('batch_records', 'Batch Records'), ('pms', 'Preventive Maintenance')], help_text='Module where metric is sourced', max_length=50)),
                ('calculation_method', models.CharField(choices=[('count', 'Count'), ('average', 'Average'), ('percentage', 'Percentage'), ('rate', 'Rate'), ('sum', 'Sum')], help_text='How the metric is calculated', max_length=50)),
                ('query_definition', models.JSONField(blank=True, default=dict, help_text='Stores the query parameters for auto-calculation (filters, aggregations, etc.)')),
                ('current_value', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('threshold_warning', models.DecimalField(blank=True, decimal_places=2, help_text='Warning threshold - metric approaching limits', max_digits=10, null=True)),
                ('threshold_critical', models.DecimalField(blank=True, decimal_places=2, help_text='Critical threshold - immediate action required', max_digits=10, null=True)),
                ('unit', models.CharField(default='count', max_length=20)),
                ('trend_direction', models.CharField(choices=[('improving', 'Improving'), ('declining', 'Declining'), ('stable', 'Stable'), ('not_applicable', 'Not Applicable')], default='not_applicable', max_length=50)),
                ('last_calculated', models.DateTimeField(blank=True, null=True)),
                ('display_order', models.IntegerField(default=0)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Quality Metric',
                'verbose_name_plural': 'Quality Metrics',
                'ordering': ['display_order', 'metric_id'],
            },
        ),
        migrations.CreateModel(
            name='MetricSnapshot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('snapshot_date', models.DateField(db_index=True)),
                ('value', models.DecimalField(decimal_places=2, max_digits=10)),
                ('period_type', models.CharField(choices=[('daily', 'Daily'), ('weekly', 'Weekly'), ('monthly', 'Monthly'), ('quarterly', 'Quarterly'), ('annual', 'Annual')], default='monthly', max_length=50)),
                ('notes', models.TextField(blank=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('metric', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='snapshots', to='management_review.qualitymetric')),
            ],
            options={
                'verbose_name': 'Metric Snapshot',
                'verbose_name_plural': 'Metric Snapshots',
                'ordering': ['-snapshot_date'],
            },
        ),
        migrations.CreateModel(
            name='DashboardConfiguration',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('layout', models.JSONField(blank=True, default=dict, help_text='Custom layout configuration (widget positions, sizes, etc.)')),
                ('refresh_interval_minutes', models.IntegerField(default=30, help_text='Auto-refresh interval in minutes')),
                ('theme', models.CharField(choices=[('default', 'Default'), ('compact', 'Compact'), ('expanded', 'Expanded')], default='default', max_length=50)),
                ('filters', models.JSONField(blank=True, default=dict, help_text='Saved filter configurations')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('role', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='users.role')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='dashboard_config', to=settings.AUTH_USER_MODEL)),
                ('visible_metrics', models.ManyToManyField(blank=True, related_name='dashboard_configs', to='management_review.qualitymetric')),
            ],
            options={
                'verbose_name': 'Dashboard Configuration',
                'verbose_name_plural': 'Dashboard Configurations',
            },
        ),
        migrations.CreateModel(
            name='QualityObjective',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('objective_id', models.CharField(db_index=True, max_length=50, unique=True)),
                ('title', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('target_value', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('current_value', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('target_date', models.DateField(blank=True, null=True)),
                ('status', models.CharField(choices=[('on_track', 'On Track'), ('at_risk', 'At Risk'), ('behind', 'Behind'), ('achieved', 'Achieved'), ('cancelled', 'Cancelled')], default='on_track', max_length=50)),
                ('fiscal_year', models.CharField(blank=True, max_length=10, null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('department', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='quality_objectives', to='users.department')),
                ('owner', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='quality_objectives', to=settings.AUTH_USER_MODEL)),
                ('target_metric', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='objectives', to='management_review.qualitymetric')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Quality Objective',
                'verbose_name_plural': 'Quality Objectives',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddIndex(
            model_name='managementreviewmeeting',
            index=models.Index(fields=['meeting_id'], name='management__meeting_c31da6_idx'),
        ),
        migrations.AddIndex(
            model_name='managementreviewmeeting',
            index=models.Index(fields=['-meeting_date'], name='management__meeting_703d93_idx'),
        ),
        migrations.AddIndex(
            model_name='managementreviewmeeting',
            index=models.Index(fields=['status'], name='management__status_c57d6a_idx'),
        ),
        migrations.AddIndex(
            model_name='managementreviewitem',
            index=models.Index(fields=['meeting'], name='management__meeting_aa069e_idx'),
        ),
        migrations.AddIndex(
            model_name='managementreviewitem',
            index=models.Index(fields=['category'], name='management__categor_d7661e_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='managementreviewitem',
            unique_together={('meeting', 'item_number')},
        ),
        migrations.AddIndex(
            model_name='managementreviewaction',
            index=models.Index(fields=['action_id'], name='management__action__080beb_idx'),
        ),
        migrations.AddIndex(
            model_name='managementreviewaction',
            index=models.Index(fields=['status'], name='management__status_94e681_idx'),
        ),
        migrations.AddIndex(
            model_name='managementreviewaction',
            index=models.Index(fields=['assigned_to'], name='management__assigne_471ed1_idx'),
        ),
        migrations.AddIndex(
            model_name='managementreviewaction',
            index=models.Index(fields=['-due_date'], name='management__due_dat_844093_idx'),
        ),
        migrations.AddIndex(
            model_name='managementreviewreport',
            index=models.Index(fields=['report_id'], name='management__report__3f05ad_idx'),
        ),
        migrations.AddIndex(
            model_name='managementreviewreport',
            index=models.Index(fields=['status'], name='management__status_126be0_idx'),
        ),
        migrations.AddIndex(
            model_name='qualitymetric',
            index=models.Index(fields=['metric_id'], name='management__metric__bf35f4_idx'),
        ),
        migrations.AddIndex(
            model_name='qualitymetric',
            index=models.Index(fields=['module'], name='management__module_33a362_idx'),
        ),
        migrations.AddIndex(
            model_name='qualitymetric',
            index=models.Index(fields=['is_active'], name='management__is_acti_4bc2f4_idx'),
        ),
        migrations.AddIndex(
            model_name='metricsnapshot',
            index=models.Index(fields=['metric', '-snapshot_date'], name='management__metric__104554_idx'),
        ),
        migrations.AddIndex(
            model_name='metricsnapshot',
            index=models.Index(fields=['snapshot_date'], name='management__snapsho_994b0c_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='metricsnapshot',
            unique_together={('metric', 'snapshot_date', 'period_type')},
        ),
        migrations.AddIndex(
            model_name='qualityobjective',
            index=models.Index(fields=['objective_id'], name='management__objecti_0203a0_idx'),
        ),
        migrations.AddIndex(
            model_name='qualityobjective',
            index=models.Index(fields=['status'], name='management__status_db41d5_idx'),
        ),
        migrations.AddIndex(
            model_name='qualityobjective',
            index=models.Index(fields=['owner'], name='management__owner_i_813bd0_idx'),
        ),
    ]
